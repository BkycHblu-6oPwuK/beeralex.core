# ะะพะดัะปั Core (beeralex.core)

ะะฐะทะพะฒัะน ะผะพะดัะปั ะดะปั ัะฐะทัะฐะฑะพัะบะธ Bitrix-ะฟัะธะปะพะถะตะฝะธะน ั ัะพะฒัะตะผะตะฝะฝัะผ ะฟะพะดัะพะดะพะผ ะบ ะฐััะธัะตะบัััะต. ะัะตะดะพััะฐะฒะปัะตั ะธะฝััััะผะตะฝัั ะดะปั ัะฐะฑะพัั ั ะธะฝัะพะฑะปะพะบะฐะผะธ, ัะตะฟะพะทะธัะพัะธัะผะธ, ัะตัะฒะธัะฐะผะธ, ะบะพะฝััะพะปะปะตัะฐะผะธ ะธ ะผะฝะพะณะพะต ะดััะณะพะต.

[![PHP](https://img.shields.io/badge/PHP-8.1+-blue.svg)](https://www.php.net/)
[![Bitrix](https://img.shields.io/badge/Bitrix-14.0.0+-orange.svg)](https://www.bitrix24.ru/)

## ะะพะทะผะพะถะฝะพััะธ

- ๐ฏ **Dependency Injection** - ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพัััะผะธ ัะตัะตะท DI-ะบะพะฝัะตะนะฝะตั
- ๐ฆ **Repository Pattern** - ะฃะดะพะฑะฝะฐั ัะฐะฑะพัะฐ ั ะดะฐะฝะฝัะผะธ (ะธะฝัะพะฑะปะพะบะธ, ัะฐะนะปะพะฐะด-ะฑะปะพะบะธ)
- โ๏ธ **ะกะตัะฒะธัั** - ะะพัะพะฒัะต ัะตัะฒะธัั ะดะปั ัะธะฟะพะฒัั ะทะฐะดะฐั
- ๐ฎ **ะะพะฝััะพะปะปะตัั** - ะะฐะทะพะฒัะต ะบะพะฝััะพะปะปะตัั ั ะฐะฒัะพะฒะฐะปะธะดะฐัะธะตะน
- ๐ง **ะะพะฝัะธะณััะฐัะธั** - ะขะธะฟะพะฑะตะทะพะฟะฐัะฝะฐั ัะธััะตะผะฐ ะฝะฐัััะพะตะบ
- ๐ **Logger** - PSR-3 ัะพะฒะผะตััะธะผะพะต ะปะพะณะธัะพะฒะฐะฝะธะต
- ๐ **Vite Integration** - ะะฝัะตะณัะฐัะธั ั ัะพะฒัะตะผะตะฝะฝัะผ ััะพะฝัะตะฝะดะพะผ

## ะัััััะน ััะฐัั

### ะฃััะฐะฝะพะฒะบะฐ

ะะพะฑะฐะฒััะต ะฒ `composer.json` ะฝะฐัััะพะนะบั ะดะปั ัััะฐะฝะพะฒะบะธ ะฒ `local/modules` (ะธะปะธ ะฒ bitrix, ััะพ ะฝะฐ ะฒะฐัะต ััะผะพััะตะฝะธะต):

```json
{
  "extra": {
    "installer-paths": {
      "local/modules/{$name}/": ["type:bitrix-module"]
    }
  }
}
```

ะฃััะฐะฝะพะฒะธัะต ะฟะฐะบะตั:

```bash
composer require beeralex/beeralex.core
```

### ะะบัะธะฒะฐัะธั

ะ ะฐะดะผะธะฝะบะต: `Marketplace -> ะฃััะฐะฝะพะฒะปะตะฝะฝัะต ัะตัะตะฝะธั -> ะฃััะฐะฝะพะฒะธัั`

ะ ะฒ `/local/php_interface/init.php`:

```php
\Bitrix\Main\Loader::includeModule('beeralex.core');
```

### ะะตัะฒัะน ะบะพะด

```php
use Beeralex\Core\Repository\IblockRepository;
use Beeralex\Core\Service\UserService;

// ะะฐะฑะพัะฐ ั ัะตะฟะพะทะธัะพัะธัะผะธ
$newsRepo = new IblockRepository('news');
$news = $newsRepo->getList(['ACTIVE' => 'Y']);

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะตัะฒะธัะพะฒ
$userService = service(UserService::class);
$password = $userService->generatePassword([2]);
```

## ะคัะฝะบัะธะธ-ัะตะปะฟะตัั

ะะพะดัะปั ะฟัะตะดะพััะฐะฒะปัะตั ะณะปะพะฑะฐะปัะฝัะต ััะฝะบัะธะธ-ะฟะพะผะพัะฝะธะบะธ ะดะปั ัะฟัะพัะตะฝะธั ัะฐะฑะพัั:

### service()

ะะพะปััะตะฝะธะต ัะตัะฒะธัะฐ ะธะท DI-ะบะพะฝัะตะนะฝะตัะฐ ั ะฟะพะดะดะตัะถะบะพะน ัะธะฟะธะทะฐัะธะธ:

```php
// ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฟัะตะดะตะปะตะฝะธะต ัะธะฟะฐ ะฑะปะฐะณะพะดะฐัั @template
$userService = service(UserService::class);
$logger = service(LoggerFactoryContract::class);
```

### firstNotEmpty()

ะะพะทะฒัะฐัะฐะตั ะฟะตัะฒะพะต ะฝะตะฟัััะพะต ะทะฝะฐัะตะฝะธะต ะธะปะธ ะทะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั:

```php
$value = firstNotEmpty('default', $var1, $var2, $var3);
// ะะตัะฝะตั ะฟะตัะฒะพะต ะฝะตะฟัััะพะต ะธะท $var1, $var2, $var3 ะธะปะธ 'default'
```

### toFile()

ะััััะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั ะฒ ัะฐะนะป (ะดะปั ะพัะปะฐะดะบะธ):

```php
toFile($data); // ะะพะณะธััะตั ะฒ default.log
toFile(['user_id' => 123, 'action' => 'login']); // ะะพะณะธััะตั ะผะฐััะธะฒ
```

### coreLog()

ะะพะณะธัะพะฒะฐะฝะธะต ัะตัะตะท ะฒัััะพะตะฝะฝัั ัะธััะตะผั Bitrix:

```php
coreLog('ะกะพะพะฑัะตะฝะธะต ะพะฑ ะพัะธะฑะบะต');
coreLog('ะะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั', 10, true); // ะก ััะฐััะธัะพะฒะบะพะน ะธ ะฐัะณัะผะตะฝัะฐะผะธ
```

### isLighthouse()

ะะฟัะตะดะตะปัะตั, ัะฒะปัะตััั ะปะธ ะทะฐะฟัะพั ะพั Google Lighthouse:

```php
if (isLighthouse()) {
    // ะกะฟะตัะธะฐะปัะฝะฐั ะปะพะณะธะบะฐ ะดะปั ะฐัะดะธัะฐ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
}
```

### isImport()

ะัะพะฒะตััะตั, ะธะดะตั ะปะธ ะพะฑะผะตะฝ ั 1ะก:

```php
if (isImport()) {
    // ะะพะณะธะบะฐ ะดะปั ะธะผะฟะพััะฐ ะธะท 1ะก
}
```

### isCli()

ะัะพะฒะตััะตั ะทะฐะฟััะตะฝ ะปะธ ัะบัะธะฟั ะธะท ะฟะพะด cli

```php
if (isCli()) {
    // ะกะบัะธะฟั ะฒัะฟะพะปะฝัะตััั ะธะท ะฟะพะด cli
}
```

## ะะพะบัะผะตะฝัะฐัะธั

๐ **[ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั](./docs/README.md)**

- [Dependency Injection](./docs/dependency-injection.md) - DI ะบะพะฝัะตะนะฝะตั
- [ะะตะฟะพะทะธัะพัะธะธ](./docs/repositories.md) - ะะฐะฑะพัะฐ ั ะดะฐะฝะฝัะผะธ
- [ะกะตัะฒะธัั](./docs/services.md) - ะัะต ัะตัะฒะธัั ะผะพะดัะปั
- [ะะพะฝััะพะปะปะตัั](./docs/controllers.md) - HTTP ะบะพะฝััะพะปะปะตัั
- [ะะพะฝัะธะณััะฐัะธั](./docs/configuration.md) - ะกะธััะตะผะฐ ะฝะฐัััะพะตะบ

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### Repository Pattern

```php
use Beeralex\Core\Repository\IblockRepository;

$newsRepo = new IblockRepository('news');

// ะะพะปััะตะฝะธะต ะดะฐะฝะฝัั ั ัะธะปัััะพะผ ะธ ัะพััะธัะพะฒะบะพะน
$items = $newsRepo->getList(
    ['ACTIVE' => 'Y'],
    [
        'select' => ['ID', 'NAME', 'DATE_CREATE'],
        'order' => ['DATE_CREATE' => 'DESC'],
        'limit' => 10
    ]
);

// ะะพะฑะฐะฒะปะตะฝะธะต ัะปะตะผะตะฝัะฐ
$id = $newsRepo->add([
    'NAME' => 'ะะพะฒะพััั',
    'ACTIVE' => 'Y',
    'PROPERTY_VALUES' => [
        'CATEGORY' => 5
    ]
]);
```

### Dependency Injection

```php
use Beeralex\Core\Service\FileService;
use Beeralex\Core\Service\PaginationService;

// ะะพะปััะตะฝะธะต ัะตัะฒะธัะพะฒ ะธะท DI-ะบะพะฝัะตะนะฝะตัะฐ
$fileService = service(FileService::class);
$paginationService = service(PaginationService::class);

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต
$fileService->includeFile('catalog.index', ['productId' => 123]);
$pages = $paginationService->getPages(1, 10);
```

### API Controller

```php
use Beeralex\Core\Http\Controllers\ApiController;

class ProductController extends ApiController
{
    public function listAction(int $limit = 10): array
    {
        $repository = new IblockRepository('catalog');
        
        return [
            'items' => $repository->getList(
                ['ACTIVE' => 'Y'],
                ['limit' => $limit]
            )
        ];
    }
}
```

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Controllers (HTTP)            โ  <- ะะฑัะฐะฑะพัะบะฐ ะทะฐะฟัะพัะพะฒ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ   Services (Business Logic)     โ  <- ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ   Repositories (Data Access)    โ  <- ะะพัััะฟ ะบ ะดะฐะฝะฝัะผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ   Models/Entities               โ  <- ะะฐะฝะฝัะต
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะขัะตะฑะพะฒะฐะฝะธั

- PHP >= 8.2
- 1ะก-ะะธััะธะบั >= 25.0.0 - ัะตะบะพะผะตะฝะดัะตะผะฐั ะฒะตััะธั ะฟะพะดะดะตัะถะธะฒะฐััะฐั php 8.2
- Composer

ัััะฐะฝะพะฒะบะฐ ะผะพะดัะปั ะฟัะพะนะดะตั ะฑะตะท ะพัะธะฑะพะบ, ะดะฐะถะต ะตัะปะธ ะฒะตััะธั ะฑะธััะธะบัะฐ ะฝะธะถะต ััะตะฑัะตะผะพะน, ะฝะพ ะผะพะณัั ะฑััั ะฝะต ััะฐะฑะธะปัะฝะพััะธ ะฒ ัะฐะฑะพัะต

## ะะธัะตะฝะทะธั

MIT

## ะะฒัะพั

Alexandr Belotsitsko (sanyabelyy020@gmail.com)
